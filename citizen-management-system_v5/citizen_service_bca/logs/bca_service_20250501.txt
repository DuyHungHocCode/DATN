2025-05-01 16:10:18,950 - app.main - INFO - BCA Citizen Service starting, logs will be saved to: logs/bca_service_20250501.txt
2025-05-01 16:14:08,964 - app.main - INFO - BCA Citizen Service starting, logs will be saved to: logs/bca_service_20250501.txt
2025-05-01 16:14:08,964 - app.main - INFO - Info message - testing logging
2025-05-01 16:14:08,964 - app.main - WARNING - Warning message - testing logging
2025-05-01 16:14:08,964 - app.main - ERROR - Error message - testing logging
2025-05-01 16:21:13,541 - app.main - INFO - BCA Citizen Service starting, logs will be saved to: logs/bca_service_20250501.txt
2025-05-01 16:21:13,542 - app.main - INFO - Info message - testing logging
2025-05-01 16:21:13,542 - app.main - WARNING - Warning message - testing logging
2025-05-01 16:21:13,542 - app.main - ERROR - Error message - testing logging
2025-05-01 16:21:13,546 - app.main - INFO - Citizen Service starting up...
2025-05-01 16:21:13,546 - app.services.kafka_consumer - INFO - Starting Kafka consumer for topic btp_events with bootstrap servers: localhost:29092
2025-05-01 16:21:13,546 - app.services.kafka_consumer - INFO - Using bootstrap servers: ['localhost:29092']
2025-05-01 16:21:13,546 - aiokafka.consumer.subscription_state - INFO - Updating subscribed topics to: frozenset({'btp_events'})
2025-05-01 16:21:13,546 - app.services.kafka_consumer - INFO - Consumer created, attempting to start...
2025-05-01 16:21:13,592 - aiokafka.consumer.group_coordinator - ERROR - Group Coordinator Request failed: [Error 15] GroupCoordinatorNotAvailableError
2025-05-01 16:21:13,695 - aiokafka.consumer.group_coordinator - ERROR - Group Coordinator Request failed: [Error 15] GroupCoordinatorNotAvailableError
2025-05-01 16:21:13,799 - aiokafka.consumer.group_coordinator - ERROR - Group Coordinator Request failed: [Error 15] GroupCoordinatorNotAvailableError
2025-05-01 16:21:13,903 - aiokafka.consumer.group_coordinator - ERROR - Group Coordinator Request failed: [Error 15] GroupCoordinatorNotAvailableError
2025-05-01 16:21:14,006 - aiokafka.consumer.group_coordinator - ERROR - Group Coordinator Request failed: [Error 15] GroupCoordinatorNotAvailableError
2025-05-01 16:21:14,118 - aiokafka.consumer.group_coordinator - INFO - Discovered coordinator 1 for group bca_consumer_group
2025-05-01 16:21:14,118 - aiokafka.consumer.group_coordinator - INFO - Revoking previously assigned partitions set() for group bca_consumer_group
2025-05-01 16:21:14,118 - aiokafka.consumer.group_coordinator - INFO - (Re-)joining group bca_consumer_group
2025-05-01 16:21:14,155 - aiokafka.consumer.group_coordinator - INFO - Joined group 'bca_consumer_group' (generation 1) with member_id aiokafka-0.12.0-746e60c3-2f5f-484d-812b-effa16e3783c
2025-05-01 16:21:14,155 - aiokafka.consumer.group_coordinator - INFO - Elected group leader -- performing partition assignments using roundrobin
2025-05-01 16:21:14,173 - aiokafka.consumer.group_coordinator - INFO - Successfully synced group bca_consumer_group with generation 1
2025-05-01 16:21:14,174 - aiokafka.consumer.group_coordinator - INFO - Setting newly assigned partitions {TopicPartition(topic='btp_events', partition=0)} for group bca_consumer_group
2025-05-01 16:21:14,174 - app.services.kafka_consumer - INFO - Consumer start() completed successfully
2025-05-01 16:21:14,174 - app.services.kafka_consumer - INFO - Kafka consumer started successfully
2025-05-01 16:21:14,181 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 4, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-04-30T19:56:10.089427+00:00Z'}
2025-05-01 16:21:14,181 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,181 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 4, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,181 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,181 - app.services.kafka_consumer - INFO - Updating death status for citizen 123456789012
2025-05-01 16:21:14,181 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 123456789012 with date 2024-05-01
2025-05-01 16:21:14,221 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,226 - app.db.citizen_repo - INFO - Successfully committed update for citizen 123456789012
2025-05-01 16:21:14,227 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 123456789012
2025-05-01 16:21:14,227 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 5, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-04-30T20:02:22.866008+00:00Z'}
2025-05-01 16:21:14,227 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,227 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 5, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,227 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,227 - app.services.kafka_consumer - INFO - Updating death status for citizen 123456789012
2025-05-01 16:21:14,228 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 123456789012 with date 2024-05-01
2025-05-01 16:21:14,228 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,230 - app.db.citizen_repo - INFO - Successfully committed update for citizen 123456789012
2025-05-01 16:21:14,230 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 123456789012
2025-05-01 16:21:14,230 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '678901234567', 'date_of_death': '2024-05-01', 'time_of_death': '10:15:00', 'place_of_death_detail': 'Tại nhà riêng', 'death_certificate_no': 'DC20240501-002', 'registration_date': '2024-05-01', 'death_certificate_id': 6, 'cause_of_death': 'Bệnh lý'}, 'timestamp': '2025-04-30T20:05:02.183635+00:00Z'}
2025-05-01 16:21:14,230 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,230 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '678901234567', 'date_of_death': '2024-05-01', 'time_of_death': '10:15:00', 'place_of_death_detail': 'Tại nhà riêng', 'death_certificate_no': 'DC20240501-002', 'registration_date': '2024-05-01', 'death_certificate_id': 6, 'cause_of_death': 'Bệnh lý'}
2025-05-01 16:21:14,230 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,231 - app.services.kafka_consumer - INFO - Updating death status for citizen 678901234567
2025-05-01 16:21:14,231 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 678901234567 with date 2024-05-01
2025-05-01 16:21:14,231 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,233 - app.db.citizen_repo - INFO - Successfully committed update for citizen 678901234567
2025-05-01 16:21:14,233 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 678901234567
2025-05-01 16:21:14,233 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '567890123456', 'date_of_death': '2024-05-01', 'time_of_death': '10:15:00', 'place_of_death_detail': 'Tại nhà riêng', 'death_certificate_no': 'DC20240501-003', 'registration_date': '2024-05-01', 'death_certificate_id': 7, 'cause_of_death': 'Bệnh lý'}, 'timestamp': '2025-04-30T20:44:23.550412+00:00Z'}
2025-05-01 16:21:14,233 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,233 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '567890123456', 'date_of_death': '2024-05-01', 'time_of_death': '10:15:00', 'place_of_death_detail': 'Tại nhà riêng', 'death_certificate_no': 'DC20240501-003', 'registration_date': '2024-05-01', 'death_certificate_id': 7, 'cause_of_death': 'Bệnh lý'}
2025-05-01 16:21:14,233 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,233 - app.services.kafka_consumer - INFO - Updating death status for citizen 567890123456
2025-05-01 16:21:14,233 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 567890123456 with date 2024-05-01
2025-05-01 16:21:14,234 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,235 - app.db.citizen_repo - INFO - Successfully committed update for citizen 567890123456
2025-05-01 16:21:14,236 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 567890123456
2025-05-01 16:21:14,236 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '234567890123', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 8, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T07:25:55.483021+00:00Z'}
2025-05-01 16:21:14,236 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,236 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '234567890123', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 8, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,236 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,236 - app.services.kafka_consumer - INFO - Updating death status for citizen 234567890123
2025-05-01 16:21:14,236 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 234567890123 with date 2024-05-01
2025-05-01 16:21:14,237 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,238 - app.db.citizen_repo - INFO - Successfully committed update for citizen 234567890123
2025-05-01 16:21:14,238 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 234567890123
2025-05-01 16:21:14,238 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '456789012345', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 9, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T07:44:45.913497+00:00'}
2025-05-01 16:21:14,238 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,238 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '456789012345', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 9, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,238 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,238 - app.services.kafka_consumer - INFO - Updating death status for citizen 456789012345
2025-05-01 16:21:14,238 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 456789012345 with date 2024-05-01
2025-05-01 16:21:14,239 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,240 - app.db.citizen_repo - INFO - Successfully committed update for citizen 456789012345
2025-05-01 16:21:14,240 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 456789012345
2025-05-01 16:21:14,240 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '345678901234', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 10, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T08:35:14.646224Z'}
2025-05-01 16:21:14,240 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,240 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '345678901234', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 10, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,240 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,240 - app.services.kafka_consumer - INFO - Updating death status for citizen 345678901234
2025-05-01 16:21:14,240 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 345678901234 with date 2024-05-01
2025-05-01 16:21:14,241 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,242 - app.db.citizen_repo - INFO - Successfully committed update for citizen 345678901234
2025-05-01 16:21:14,242 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 345678901234
2025-05-01 16:21:14,242 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 3, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T08:39:36.006173Z'}
2025-05-01 16:21:14,242 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,242 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 3, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,242 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,242 - app.services.kafka_consumer - INFO - Updating death status for citizen 123456789012
2025-05-01 16:21:14,242 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 123456789012 with date 2024-05-01
2025-05-01 16:21:14,243 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,244 - app.db.citizen_repo - INFO - Successfully committed update for citizen 123456789012
2025-05-01 16:21:14,244 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 123456789012
2025-05-01 16:21:14,245 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 3, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T08:42:15.182525Z'}
2025-05-01 16:21:14,245 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,245 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 3, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,245 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,245 - app.services.kafka_consumer - INFO - Updating death status for citizen 123456789012
2025-05-01 16:21:14,245 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 123456789012 with date 2024-05-01
2025-05-01 16:21:14,245 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,247 - app.db.citizen_repo - INFO - Successfully committed update for citizen 123456789012
2025-05-01 16:21:14,247 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 123456789012
2025-05-01 16:21:14,247 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '345678901234', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 4, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T09:15:05.559760Z'}
2025-05-01 16:21:14,247 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:21:14,247 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '345678901234', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 4, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:21:14,247 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:21:14,247 - app.services.kafka_consumer - INFO - Updating death status for citizen 345678901234
2025-05-01 16:21:14,247 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 345678901234 with date 2024-05-01
2025-05-01 16:21:14,248 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:21:14,249 - app.db.citizen_repo - INFO - Successfully committed update for citizen 345678901234
2025-05-01 16:21:14,249 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 345678901234
2025-05-01 16:25:27,880 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 7, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T09:25:27.875261Z'}
2025-05-01 16:25:27,880 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:25:27,880 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '123456789012', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 7, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:25:27,880 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:25:27,880 - app.services.kafka_consumer - INFO - Updating death status for citizen 123456789012
2025-05-01 16:25:27,881 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 123456789012 with date 2024-05-01
2025-05-01 16:25:27,882 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:25:27,883 - app.db.citizen_repo - INFO - Successfully committed update for citizen 123456789012
2025-05-01 16:25:27,884 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 123456789012
2025-05-01 16:35:40,182 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '234567890123', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 8, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T09:35:40.178094Z'}
2025-05-01 16:35:40,182 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:35:40,182 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '234567890123', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 8, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:35:40,182 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:35:40,182 - app.services.kafka_consumer - INFO - Updating death status for citizen 234567890123
2025-05-01 16:35:40,182 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 234567890123 with date 2024-05-01
2025-05-01 16:35:40,183 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:35:40,184 - app.db.citizen_repo - INFO - Successfully committed update for citizen 234567890123
2025-05-01 16:35:40,185 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 234567890123
2025-05-01 16:35:40,351 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '345678901234', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 9, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-01T09:35:40.346857Z'}
2025-05-01 16:35:40,351 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-01 16:35:40,351 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '345678901234', 'date_of_death': '2024-05-01', 'time_of_death': '08:30:00', 'place_of_death_detail': 'Bệnh viện Bạch Mai, Hà Nội', 'death_certificate_no': 'DC20240501-001', 'registration_date': '2024-05-01', 'death_certificate_id': 9, 'cause_of_death': 'Đột quỵ'}
2025-05-01 16:35:40,351 - app.services.kafka_consumer - INFO - Parsed date of death: 2024-05-01
2025-05-01 16:35:40,351 - app.services.kafka_consumer - INFO - Updating death status for citizen 345678901234
2025-05-01 16:35:40,351 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 345678901234 with date 2024-05-01
2025-05-01 16:35:40,354 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-01 16:35:40,355 - app.db.citizen_repo - INFO - Successfully committed update for citizen 345678901234
2025-05-01 16:35:40,355 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 345678901234
2025-05-01 19:56:03,919 - aiokafka.consumer.group_coordinator - ERROR - Error sending HeartbeatRequest_v1 to node 1 [KafkaConnectionError: Connection at localhost:29092 closed] -- marking coordinator dead
2025-05-01 19:56:03,920 - aiokafka.consumer.group_coordinator - WARNING - Marking the coordinator dead (node 1)for group bca_consumer_group.
2025-05-01 19:56:03,920 - aiokafka.consumer.group_coordinator - ERROR - Heartbeat send request failed: KafkaConnectionError: Connection at localhost:29092 closed. Will retry.
2025-05-01 19:56:03,942 - aiokafka.consumer.group_coordinator - INFO - Discovered coordinator 1 for group bca_consumer_group
2025-05-01 19:56:04,023 - aiokafka.consumer.group_coordinator - WARNING - Heartbeat failed: local member_id was not recognized; resetting and re-joining group
2025-05-01 19:56:04,027 - aiokafka.consumer.group_coordinator - INFO - Revoking previously assigned partitions frozenset({TopicPartition(topic='btp_events', partition=0)}) for group bca_consumer_group
2025-05-01 19:56:04,028 - aiokafka.consumer.group_coordinator - INFO - (Re-)joining group bca_consumer_group
2025-05-01 19:56:04,033 - aiokafka.consumer.group_coordinator - INFO - Joined group 'bca_consumer_group' (generation 3) with member_id aiokafka-0.12.0-8a93acbc-e2fa-49c4-baa3-013a683ae734
2025-05-01 19:56:04,033 - aiokafka.consumer.group_coordinator - INFO - Elected group leader -- performing partition assignments using roundrobin
2025-05-01 19:56:04,036 - aiokafka.consumer.group_coordinator - INFO - Successfully synced group bca_consumer_group with generation 3
2025-05-01 19:56:04,036 - aiokafka.consumer.group_coordinator - INFO - Setting newly assigned partitions {TopicPartition(topic='btp_events', partition=0)} for group bca_consumer_group
