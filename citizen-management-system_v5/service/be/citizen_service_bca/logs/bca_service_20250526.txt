2025-05-26 15:08:39,384 - app.main - INFO - BCA Citizen Service starting, logs will be saved to: logs/bca_service_20250526.txt
2025-05-26 15:08:39,390 - app.main - INFO - Citizen Service starting up...
2025-05-26 15:08:39,391 - app.services.kafka_consumer - INFO - Starting Kafka consumer for topic btp_events with bootstrap servers: localhost:29092
2025-05-26 15:08:39,391 - app.services.kafka_consumer - INFO - Using bootstrap servers: ['localhost:29092']
2025-05-26 15:08:39,391 - aiokafka.consumer.subscription_state - INFO - Updating subscribed topics to: frozenset({'btp_events'})
2025-05-26 15:08:39,391 - app.services.kafka_consumer - INFO - Consumer created, attempting to start...
2025-05-26 15:08:39,408 - aiokafka.consumer.group_coordinator - INFO - Discovered coordinator 1 for group bca_consumer_group
2025-05-26 15:08:39,408 - aiokafka.consumer.group_coordinator - INFO - Revoking previously assigned partitions set() for group bca_consumer_group
2025-05-26 15:08:39,408 - aiokafka.consumer.group_coordinator - INFO - (Re-)joining group bca_consumer_group
2025-05-26 15:08:39,422 - aiokafka.consumer.group_coordinator - INFO - Joined group 'bca_consumer_group' (generation 121) with member_id aiokafka-0.12.0-e7a0787a-2a9f-47e8-91af-f5a09e4fcd20
2025-05-26 15:08:39,422 - aiokafka.consumer.group_coordinator - INFO - Elected group leader -- performing partition assignments using roundrobin
2025-05-26 15:08:39,431 - aiokafka.consumer.group_coordinator - INFO - Successfully synced group bca_consumer_group with generation 121
2025-05-26 15:08:39,431 - aiokafka.consumer.group_coordinator - INFO - Setting newly assigned partitions {TopicPartition(topic='btp_events', partition=0)} for group bca_consumer_group
2025-05-26 15:08:39,431 - app.services.kafka_consumer - INFO - Consumer start() completed successfully
2025-05-26 15:08:39,431 - app.services.kafka_consumer - INFO - Kafka consumer started successfully
2025-05-26 15:08:39,432 - app.main - INFO - Redis client already initialized.
2025-05-26 15:27:44,234 - app.main - INFO - Citizen Service shutting down...
2025-05-26 15:27:44,234 - app.services.kafka_consumer - INFO - Stopping Kafka consumer...
2025-05-26 15:27:44,242 - aiokafka.consumer.group_coordinator - INFO - LeaveGroup request succeeded
2025-05-26 15:27:44,242 - app.services.kafka_consumer - INFO - Kafka consumer stopped
2025-05-26 15:27:44,242 - app.main - INFO - Redis client connection closed.
2025-05-26 15:27:44,757 - app.main - INFO - BCA Citizen Service starting, logs will be saved to: logs/bca_service_20250526.txt
2025-05-26 15:27:44,763 - app.main - INFO - Citizen Service starting up...
2025-05-26 15:27:44,763 - app.services.kafka_consumer - INFO - Starting Kafka consumer for topic btp_events with bootstrap servers: localhost:29092
2025-05-26 15:27:44,763 - app.services.kafka_consumer - INFO - Using bootstrap servers: ['localhost:29092']
2025-05-26 15:27:44,763 - aiokafka.consumer.subscription_state - INFO - Updating subscribed topics to: frozenset({'btp_events'})
2025-05-26 15:27:44,763 - app.services.kafka_consumer - INFO - Consumer created, attempting to start...
2025-05-26 15:27:44,771 - aiokafka.consumer.group_coordinator - INFO - Discovered coordinator 1 for group bca_consumer_group
2025-05-26 15:27:44,771 - aiokafka.consumer.group_coordinator - INFO - Revoking previously assigned partitions set() for group bca_consumer_group
2025-05-26 15:27:44,771 - aiokafka.consumer.group_coordinator - INFO - (Re-)joining group bca_consumer_group
2025-05-26 15:27:44,773 - aiokafka.consumer.group_coordinator - INFO - Joined group 'bca_consumer_group' (generation 123) with member_id aiokafka-0.12.0-fb6c87b8-f3b5-4d80-bf1d-d2ec9e2c469c
2025-05-26 15:27:44,773 - aiokafka.consumer.group_coordinator - INFO - Elected group leader -- performing partition assignments using roundrobin
2025-05-26 15:27:44,775 - aiokafka.consumer.group_coordinator - INFO - Successfully synced group bca_consumer_group with generation 123
2025-05-26 15:27:44,775 - aiokafka.consumer.group_coordinator - INFO - Setting newly assigned partitions {TopicPartition(topic='btp_events', partition=0)} for group bca_consumer_group
2025-05-26 15:27:44,775 - app.services.kafka_consumer - INFO - Consumer start() completed successfully
2025-05-26 15:27:44,775 - app.services.kafka_consumer - INFO - Kafka consumer started successfully
2025-05-26 15:27:44,775 - app.main - INFO - Redis client already initialized.
2025-05-26 15:27:57,404 - app.main - INFO - Citizen Service shutting down...
2025-05-26 15:27:57,405 - app.services.kafka_consumer - INFO - Stopping Kafka consumer...
2025-05-26 15:27:57,409 - aiokafka.consumer.group_coordinator - INFO - LeaveGroup request succeeded
2025-05-26 15:27:57,409 - app.services.kafka_consumer - INFO - Kafka consumer stopped
2025-05-26 15:27:57,409 - app.main - INFO - Redis client connection closed.
2025-05-26 15:27:57,885 - app.main - INFO - BCA Citizen Service starting, logs will be saved to: logs/bca_service_20250526.txt
2025-05-26 15:27:57,890 - app.main - INFO - Citizen Service starting up...
2025-05-26 15:27:57,890 - app.services.kafka_consumer - INFO - Starting Kafka consumer for topic btp_events with bootstrap servers: localhost:29092
2025-05-26 15:27:57,890 - app.services.kafka_consumer - INFO - Using bootstrap servers: ['localhost:29092']
2025-05-26 15:27:57,891 - aiokafka.consumer.subscription_state - INFO - Updating subscribed topics to: frozenset({'btp_events'})
2025-05-26 15:27:57,891 - app.services.kafka_consumer - INFO - Consumer created, attempting to start...
2025-05-26 15:27:57,897 - aiokafka.consumer.group_coordinator - INFO - Discovered coordinator 1 for group bca_consumer_group
2025-05-26 15:27:57,898 - aiokafka.consumer.group_coordinator - INFO - Revoking previously assigned partitions set() for group bca_consumer_group
2025-05-26 15:27:57,898 - aiokafka.consumer.group_coordinator - INFO - (Re-)joining group bca_consumer_group
2025-05-26 15:27:57,900 - aiokafka.consumer.group_coordinator - INFO - Joined group 'bca_consumer_group' (generation 125) with member_id aiokafka-0.12.0-0ce461bf-4064-462f-8c2c-dee415c2499a
2025-05-26 15:27:57,900 - aiokafka.consumer.group_coordinator - INFO - Elected group leader -- performing partition assignments using roundrobin
2025-05-26 15:27:57,901 - aiokafka.consumer.group_coordinator - INFO - Successfully synced group bca_consumer_group with generation 125
2025-05-26 15:27:57,901 - aiokafka.consumer.group_coordinator - INFO - Setting newly assigned partitions {TopicPartition(topic='btp_events', partition=0)} for group bca_consumer_group
2025-05-26 15:27:57,901 - app.services.kafka_consumer - INFO - Consumer start() completed successfully
2025-05-26 15:27:57,901 - app.services.kafka_consumer - INFO - Kafka consumer started successfully
2025-05-26 15:27:57,901 - app.main - INFO - Redis client already initialized.
2025-05-26 15:30:16,457 - app.services.kafka_consumer - INFO - Received message: {'eventType': 'citizen_died', 'payload': {'citizen_id': '001198752461', 'date_of_death': '2025-05-25', 'time_of_death': '10:30:00', 'place_of_death_detail': 'Tại nhà riêng, Số 105, Ngách 12, Ngõ 4, Thổ Quan', 'death_certificate_no': 'GCT-2025-00001', 'registration_date': '2025-05-26', 'death_certificate_id': 3, 'cause_of_death': 'Đột quỵ'}, 'timestamp': '2025-05-26T08:30:16.421261Z'}
2025-05-26 15:30:16,457 - app.services.kafka_consumer - INFO - Processing event: citizen_died
2025-05-26 15:30:16,457 - app.services.kafka_consumer - INFO - Processing citizen_died event with payload: {'citizen_id': '001198752461', 'date_of_death': '2025-05-25', 'time_of_death': '10:30:00', 'place_of_death_detail': 'Tại nhà riêng, Số 105, Ngách 12, Ngõ 4, Thổ Quan', 'death_certificate_no': 'GCT-2025-00001', 'registration_date': '2025-05-26', 'death_certificate_id': 3, 'cause_of_death': 'Đột quỵ'}
2025-05-26 15:30:16,457 - app.services.kafka_consumer - INFO - Parsed date of death: 2025-05-25
2025-05-26 15:30:16,458 - app.services.kafka_consumer - INFO - Updating death status for citizen 001198752461
2025-05-26 15:30:16,458 - app.db.citizen_repo - INFO - Calling stored procedure to update death status for citizen 001198752461 with date 2025-05-25
2025-05-26 15:30:16,511 - app.db.citizen_repo - INFO - Stored procedure returned affected_rows: 1
2025-05-26 15:30:16,513 - app.db.citizen_repo - INFO - Successfully committed update for citizen 001198752461
2025-05-26 15:30:16,514 - app.services.kafka_consumer - INFO - Successfully updated death status for citizen 001198752461
2025-05-26 15:59:43,894 - app.db.reference_repo - INFO - Cache miss for reference table: Wards. Fetching from DB.
2025-05-26 16:00:16,457 - app.db.reference_repo - INFO - Cached data for reference table: Wards
